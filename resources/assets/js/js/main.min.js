$(document).ready(function() {

    $('.trial-btn').on('click', function(){

        var email = $(this).prev().val();

        if (isValidEmail(email)) {
            $(this).prev().css('background', 'white');
            localStorage.setItem('trialEmail', email);
            window.location.replace("/auth/register");
        } else {
            $(this).prev().css('background', '#ffb29a');
        }

        return false;
    });

    function isValidEmail(string) {

        var atSym = string.lastIndexOf("@");
        var space = string.lastIndexOf(" ");
        if (space > 1) {
            return false;
        }
        if (atSym < 1) {
            return false;
        }
        if (atSym == string.length - 1) {
            return false;
        }
        if (atSym > 64) {
            return false;
        }
        if (string.length - atSym > 255) {
            return false;
        }
        var lastDot = string.lastIndexOf(".");
        if (lastDot > atSym + 1 && lastDot < string.length - 1) {
            return true;
        }
        if (string.charAt(atSym + 1) == '[' && string.charAt(string.length - 1) == ']') {
            return true;
        }
        return false;
    }


    //табы для блока functions

    $('ul.tabs_list').on('click', 'li:not(.active)', function() {
        $(this)
            .addClass('active').siblings().removeClass('active')
            .closest('div.tabs_block').find('div.tabs_content').removeClass('active').eq($(this).index()).addClass('active');
    });

    //табы для блока с ценами

    $('.cost_tabs_list ul').on('click', 'li:not(.active)', function() {
        $(this)
            .addClass('active').siblings().removeClass('active')
            .closest('div.cost_block').find('div.cost_tabs_content').removeClass('active').eq($(this).index()).addClass('active');
        $('.cost_sing p:not(.active)').addClass('active').siblings().removeClass('active')
    });

    //открытие меню на бургер

    $('.c-menu_burger').click(function() {
        $('.menu_mobile').toggleClass('show_menu');
        $(this).toggleClass('krest');
        $('.menu_lang ul').fadeOut();
        $('.menu_lang_active').removeClass('open');
    });

    //закрытие меню по документу

    $(document).on('click touchstart', function(e) {
        if (!$(e.target).closest(".menu_burger").length) {
            $('.menu_mobile').removeClass('show_menu');
            $('.c-menu_burger').removeClass('krest');
            $('.menu_lang ul').fadeOut();
            $('.menu_lang_active').removeClass('open');
        }
    });

    //открытие меню для выбора языка в мобильном меню (меньше 576px)

    $('.menu_lang_active').click(function() {
        $('.menu_lang ul').fadeToggle();
        $(this).toggleClass('open');
    });

    //открытие меню выбора языков десктоп

    $('.lang a.lang_active').click(function() {
        $('.lang_list_block').toggleClass('show_list');
        return false;
    });

    //закрытие меню выбора языков по документу

    $(document).on('click touchstart', function(e) {
        if (!$(e.target).closest(".lang").length) {
            $('.lang_list_block').removeClass('show_list');
        }
    });

    //скролл шапки с меню

    $("#header").headroom({
        "offset": 5,
        "tolerance": 1,
        "classes": {
            "initial": "line_menu",
            "pinned": "fixed-top",
            "unpinned": "fixed-bottom"
        }
    });


    //скролл для ссылок в верхнем меню

    $('.header_menu_link').click(function(event) {
        event.preventDefault();
        var id = $(this).attr('href'),
            top = $(id).offset().top;
        $('body, html').animate({scrollTop: top}, 1500);
    });

    //скролл для ссвылок в мобильном меню

    $('.main_menu_link').click(function(event) {
        event.preventDefault();
        var id = $(this).attr('href'),
            top = $(id).offset().top;
        $('body, html').animate({scrollTop: top}, 1500);
        $('.menu_mobile').removeClass('show_menu');
        $('.c-menu_burger').removeClass('krest');
        $('.menu_lang ul').fadeOut();
        $('.menu_lang_active').removeClass('open');
    });

    $('.comp_abs_content .notification_block .notification_item').eq(0).addClass('active');

    setInterval('blockAnimate();', 3000);

    $('.phone_abs .c-phone_abs').eq(0).addClass('active');

    setInterval('blockAnimate2();', 3000);

    $('.c-monitor_abs .notification_block .notification_item').eq(0).addClass('active');

    setInterval('blockAnimate3();', 3000);

    $(document).scroll(function() {
        var scroll = $(this).scrollTop();
        var scroll_elem = $('.one_step').offset().top + 450;
        if (scroll > scroll_elem ) {
            $('.two_step_img .two_step_block_animated').addClass('animated');
        } else {
            $('.two_step_img .two_step_block_animated').removeClass('animated');
        }
    });

    $(document).scroll(function() {
        var scroll = $(this).scrollTop();
        var scroll_elem = $('.one_step').offset().top + 100;
        if (scroll > scroll_elem ) {
            $('.one_step_img .two_step_block_animated').addClass('animated');
        } else {
            $('.one_step_img .two_step_block_animated').removeClass('animated');
        }
    });

    $(document).scroll(function() {
        var scroll = $(this).scrollTop();
        var scroll_elem = $('.three_step').offset().top - 100;
        if (scroll > scroll_elem ) {
            $('.three_step_block_animated').addClass('animated');
        } else {
            $('.three_step_block_animated').removeClass('animated');
        }
    });

    var speedValue = 700;

    var counter = 1;

      var slider = tns({
        container: '#notification_slider',
        items: 3,
        controls: false,
        navContainer: false,
        axis: "vertical",
        swipeAngle: false,
        speed: 500,
        autoplay: true,
        navAsThumbnails: false,
        loop: true,
        onInit: function() {
            $('.tns-slide-active')[1].className = 'notification_slider_item tns-item tns-slide-active slick-center';             
            $('.tns-slide-active')[1].setAttribute('data-item', counter);
            counter++;
        }
      });

    var customizedFunction = function (info, eventName) {
        $('.tns-slide-active')[0].className = 'notification_slider_item tns-item tns-slide-active';
        if (!$('.tns-slide-active')[0].getAttribute('data-item')) { $('.tns-slide-active')[0].setAttribute('data-item', counter); counter++; }
        $('.tns-slide-active')[1].className = 'notification_slider_item tns-item tns-slide-active slick-center';
        if (!$('.tns-slide-active')[1].getAttribute('data-item')) { $('.tns-slide-active')[1].setAttribute('data-item', counter); counter++; }
        $('.tns-slide-active')[2].className = 'notification_slider_item tns-item tns-slide-active';
        if (!$('.tns-slide-active')[2].getAttribute('data-item')) { $('.tns-slide-active')[2].setAttribute('data-item', counter); counter++; }
        
        var current = $('.tns-slide-active')[1].getAttribute('data-item');
        //console.log(current);
        if(current == 8) {
            console.log(8);
            $('*[data-item="4"]')[0].className = 'notification_slider_item tns-item tns-slide-active slick-center';
        }

    }

    // bind function to event
    slider.events.on('transitionStart', customizedFunction);

    /*$('.c-notification_slider').slick({
        slidesToShow: 3,
        centerMode: true,
        centerPadding: '5px',
        useTransform: true,
        autoplay: true,
        draggable: true,
        autoplaySpeed: 1000,
        arrows: false,
        dots: false,
        swipe: false,
        infinite: true,
        vertical: true,
        pauseOnFocus: false,
        dots: false,
        //speed: speedValue,
        arrows: false,
        pauseOnHover: false,
        //cssEase: 'cubic-bezier(.31,.08,.21,.98)'
    });*/

});

function blockAnimate() {
    var length = $('.comp_abs_content .notification_block .notification_item').length - 1;
    $('.comp_abs_content .notification_block .notification_item').each(function(index) {
        if($(this).hasClass('active') && index != length) {
            $(this).removeClass('active').next('.notification_item').addClass('active');
            return false;
        } else if (index == length) {
            $(this).removeClass('active');
            $('.comp_abs_content .notification_block .notification_item').eq(0).addClass('active');
            return false;
        }
    });
};

function blockAnimate2() {
    var length = $('.phone_abs .c-phone_abs').length - 1;
    $('.phone_abs .c-phone_abs').each(function(index) {
        if($(this).hasClass('active') && index != length) {
            $(this).removeClass('active').next('.c-phone_abs').addClass('active');
            return false;
        } else if (index == length) {
            $(this).removeClass('active');
            $('.phone_abs .c-phone_abs').eq(0).addClass('active');
            return false;
        }
    });
};

function blockAnimate3() {
    var length = $('.tabs_content.active .c-monitor_abs .notification_block .notification_item').length - 1;
    $('.tabs_content.active .c-monitor_abs .notification_block .notification_item').each(function(index) {
        if($(this).hasClass('active') && index != length) {
            $(this).removeClass('active').next('.notification_item').addClass('active');
            return false;
        } else if (index == length) {
            $(this).removeClass('active');
            $('.tabs_content.active .c-monitor_abs .notification_block .notification_item').eq(0).addClass('active');
            return false;
        }
    });
};